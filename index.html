<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Kondr Padel Birthday 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0f172a">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <!-- Screenshot -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'neon-blue': '#3b82f6',
            'neon-purple': '#8b5cf6',
            'dark-bg': '#0f172a',
            'glass': 'rgba(255, 255, 255, 0.05)',
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'bounce-slow': 'bounce 2s infinite',
          }
        }
      }
    }
  </script>
  <style>
    body { 
        font-family: 'Inter', sans-serif; 
        -webkit-tap-highlight-color: transparent; 
        background-color: #0f172a; 
        color: #e2e8f0;
    }
    .hide-scroll::-webkit-scrollbar { display: none; }
    .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    .tap-effect:active { transform: scale(0.96); }
    
    .glass-panel {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .glass-gold {
        background: linear-gradient(135deg, rgba(234, 179, 8, 0.15), rgba(0,0,0,0.6));
        border: 1px solid rgba(234, 179, 8, 0.4);
        box-shadow: 0 0 20px rgba(234, 179, 8, 0.1);
    }
    
    .glass-bronze {
        background: linear-gradient(135deg, rgba(249, 115, 22, 0.15), rgba(0,0,0,0.6));
        border: 1px solid rgba(249, 115, 22, 0.4);
    }

    /* Dropdown styling */
    .score-select { 
        text-align: center; 
        text-align-last: center;
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: white;
        outline: none;
        font-family: monospace;
        font-weight: bold;
        font-size: 1.1rem;
        appearance: none; /* Hide default arrow */
        padding: 0;
        transition: all 0.2s;
        cursor: pointer;
    }
    .score-select:focus { 
        border-color: #3b82f6; 
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        background: rgba(0, 0, 0, 0.6);
    }

    .bg-gradient-animate {
        background: linear-gradient(-45deg, #0f172a, #1e1b4b, #172554, #0f172a);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
    }
    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Toast */
    #toast {
        visibility: hidden; opacity: 0; transform: translate(-50%, 20px); transition: all 0.3s;
    }
    #toast.show { visibility: visible; opacity: 1; transform: translate(-50%, 0); }
  </style>
</head>
<body class="bg-gradient-animate h-screen flex flex-col overflow-hidden relative selection:bg-neon-blue selection:text-white">

  <!-- Toast -->
  <div id="toast" class="fixed bottom-10 left-1/2 glass-panel text-white px-6 py-3 rounded-full shadow-2xl z-[80] font-medium text-sm text-center whitespace-nowrap pointer-events-none flex items-center gap-2 border-neon-blue/30">
    <span id="toast-icon">üì∏</span> <span id="toast-msg">–§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!</span>
  </div>

  <!-- Rules Modal -->
  <div id="rules-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4 backdrop-blur-md">
    <div class="glass-panel bg-slate-900 rounded-2xl shadow-2xl p-6 w-full max-w-sm transform transition-all scale-100 border border-white/10 relative">
      <button id="close-rules" class="absolute top-4 right-4 text-gray-400 hover:text-white">‚úï</button>
      <div class="flex items-center gap-3 mb-5">
          <div class="w-10 h-10 rounded-full bg-neon-blue/20 flex items-center justify-center text-xl">üìã</div>
          <div>
              <h3 class="text-lg font-bold text-white leading-none">–ü—Ä–∞–≤–∏–ª–∞ –¢—É—Ä–Ω–∏—Ä–∞</h3>
              <div class="text-xs text-gray-400 mt-1">–§–æ—Ä–º–∞—Ç: Super Tie-Break</div>
          </div>
      </div>
      <ul class="space-y-4 text-sm text-gray-300">
          <li class="flex gap-3"><span class="text-neon-blue font-bold">1.</span><span><strong class="text-white">–°—á–µ—Ç –ø–æ –æ—á–∫–∞–º.</strong> 1, 2, 3... –±–µ–∑ –≥–µ–π–º–æ–≤.</span></li>
          <li class="flex gap-3"><span class="text-neon-blue font-bold">2.</span><span><strong class="text-white">–í—Ä–µ–º—è ‚Äî 25 –º–∏–Ω.</strong> –ö—Ç–æ –≤–µ–¥–µ—Ç –≤ —Å—á–µ—Ç–µ –ø–æ —Å–∏—Ä–µ–Ω–µ ‚Äî –ø–æ–±–µ–¥–∏–ª.</span></li>
          <li class="flex gap-3"><span class="text-neon-blue font-bold">3.</span><span><strong class="text-white">–ü–æ–¥–∞—á–∞.</strong> –°–º–µ–Ω–∞ –∫–∞–∂–¥—ã–µ 2 –æ—á–∫–∞.</span></li>
          <li class="flex gap-3"><span class="text-neon-blue font-bold">4.</span><span><strong class="text-white">–ù–∏—á—å—è.</strong> –†–µ—à–∞—é—â–∏–π —Ä–æ–∑—ã–≥—Ä—ã—à ("–ó–æ–ª–æ—Ç–æ–µ –æ—á–∫–æ").</span></li>
      </ul>
      <button id="rules-ok" class="w-full mt-6 py-3 bg-neon-blue text-white font-bold rounded-xl hover:bg-blue-600 transition-colors shadow-lg shadow-blue-500/30">–ü–æ–Ω—è—Ç–Ω–æ!</button>
    </div>
  </div>

  <!-- Reset Modal -->
  <div id="reset-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4 backdrop-blur-md">
    <div class="glass-panel bg-slate-900 rounded-2xl shadow-2xl p-6 w-full max-w-xs transform transition-all scale-100 border border-white/10">
      <h3 class="text-lg font-bold text-white mb-2">–°–±—Ä–æ—Å —Ç—É—Ä–Ω–∏—Ä–∞</h3>
      <p class="text-sm text-gray-400 mb-6">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?</p>
      <div class="flex gap-3">
        <button id="modal-cancel" class="flex-1 py-3 bg-white/5 text-gray-300 font-bold rounded-xl hover:bg-white/10 transition-colors">–ù–µ—Ç</button>
        <button id="modal-confirm" class="flex-1 py-3 bg-red-500/80 text-white font-bold rounded-xl hover:bg-red-500 shadow-lg shadow-red-500/20 transition-colors">–î–∞</button>
      </div>
    </div>
  </div>

  <!-- Photo Modal -->
  <div id="photo-modal" class="fixed inset-0 bg-black/90 z-[70] hidden flex flex-col items-center justify-center p-4 backdrop-blur-md">
    <div class="w-full max-w-md flex flex-col gap-4 relative">
        <div class="flex justify-between items-center text-white">
            <h3 class="font-bold text-lg">–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
            <button id="close-photo-modal" class="bg-white/10 p-2 rounded-full hover:bg-white/20">‚úï</button>
        </div>
        <div id="photo-container" class="rounded-xl overflow-hidden border border-white/20 shadow-2xl"></div>
        <div class="text-center"><p class="text-neon-blue text-sm font-bold mb-2 animate-pulse">üëÜ –ó–∞–∂–º–∏—Ç–µ —Ñ–æ—Ç–æ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</p></div>
    </div>
  </div>

  <!-- Loader -->
  <div id="screenshot-loader" class="fixed inset-0 bg-black/90 z-[90] hidden flex flex-col items-center justify-center p-4 backdrop-blur-md">
    <div class="animate-spin rounded-full h-12 w-12 border-4 border-neon-blue border-t-transparent mb-4"></div>
    <div class="text-white font-bold text-lg tracking-wider">RENDERING...</div>
  </div>

  <!-- HEADER -->
  <header class="glass-panel border-b-0 z-20 flex-none">
    <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="relative">
            <div class="absolute inset-0 bg-neon-blue blur opacity-40 rounded-xl"></div>
            <div class="relative w-10 h-10 rounded-xl bg-gradient-to-br from-slate-800 to-black border border-white/10 text-white flex items-center justify-center font-black text-xs shadow-lg">KP</div>
        </div>
        <div>
          <h1 class="text-sm font-extrabold uppercase leading-none text-white tracking-widest">Kondr Padel</h1>
          <div class="text-[10px] font-medium text-neon-blue mt-1">BIRTHDAY TOUR 2025</div>
        </div>
      </div>
      <div class="flex gap-2">
        <button id="rules-btn" class="bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-2 rounded-lg text-xs font-bold text-gray-200 transition-colors tap-effect">‚ÑπÔ∏è</button>
        <button id="share-btn" class="bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-2 rounded-lg text-xs font-bold text-gray-200 transition-colors flex items-center gap-2 tap-effect"><span>üì∏</span></button>
        <button id="reset-btn-trigger" class="bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-2 rounded-lg text-xs font-medium text-gray-400 transition-colors tap-effect">‚ôªÔ∏è</button>
      </div>
    </div>
    <div class="px-4 py-2 border-t border-white/5 overflow-x-auto hide-scroll whitespace-nowrap flex gap-3">
      <div class="flex flex-col items-center justify-center px-3 py-1.5 rounded-lg bg-white/5 border border-white/5 min-w-[85px]"><span class="text-xs font-black text-blue-400">–ê&–û</span></div>
      <div class="flex flex-col items-center justify-center px-3 py-1.5 rounded-lg bg-white/5 border border-white/5 min-w-[85px]"><span class="text-xs font-black text-indigo-400">–†&–ü</span></div>
      <div class="flex flex-col items-center justify-center px-3 py-1.5 rounded-lg bg-white/5 border border-white/5 min-w-[85px]"><span class="text-xs font-black text-purple-400">–ù&–ú</span></div>
      <div class="flex flex-col items-center justify-center px-3 py-1.5 rounded-lg bg-white/5 border border-white/5 min-w-[85px]"><span class="text-xs font-black text-orange-400">–°&–ö</span></div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="flex-1 overflow-y-auto p-3 sm:p-4 max-w-5xl mx-auto w-full">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-8 h-full pb-10">
      
      <!-- LEFT -->
      <div class="lg:col-span-7 flex flex-col gap-6">
        <div class="flex flex-col gap-3">
            <div class="glass-panel rounded-xl p-3 flex justify-between items-center mb-1">
              <div class="flex items-center gap-2">
                <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-neon-blue opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-neon-blue"></span></span>
                <span class="text-xs font-bold text-gray-300">17:00</span>
              </div>
              <span class="text-xs font-bold text-neon-blue uppercase tracking-wider">–†–∞–∑–º–∏–Ω–∫–∞ 10 –º–∏–Ω</span>
            </div>
            <div class="flex justify-between items-center px-1">
                <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">–ì—Ä—É–ø–ø–æ–≤–æ–π —ç—Ç–∞–ø</span>
                <span class="text-[10px] text-gray-500">25 –º–∏–Ω/—Ä–∞—É–Ω–¥</span>
            </div>
            <div id="matches-container" class="space-y-3"></div>
        </div>
        <div id="playoffs-section" class="hidden flex-col gap-4 pt-4 border-t border-white/10">
             <div class="flex items-center justify-between px-1 mb-1">
                <div class="flex items-center gap-2">
                    <span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-500 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-yellow-500"></span></span>
                    <span class="text-sm font-black text-white uppercase tracking-widest">–§–ò–ù–ê–õ–´</span>
                </div>
                <span class="text-xs font-bold text-yellow-500">18:30 ‚Äì 19:00</span>
            </div>
            <div id="finals-container" class="space-y-4"></div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="lg:col-span-5 flex flex-col gap-3">
        <div id="capture-target" class="flex flex-col gap-3 rounded-xl bg-[#0f172a] p-2 relative">
            <div id="screenshot-header" class="hidden p-4 bg-gradient-to-r from-blue-700 to-purple-800 rounded-xl text-white text-center mb-2 border border-white/20 shadow-lg">
                <div class="text-2xl font-black uppercase tracking-widest text-white">Kondr Padel</div>
                <div class="text-xs text-blue-100 font-mono mt-1 opacity-80">BIRTHDAY 2025 RESULTS</div>
            </div>
            <div id="screenshot-podium" class="hidden flex-row justify-center gap-2 mb-2">
                <div class="flex flex-col items-center justify-end w-1/3 pt-4">
                     <div class="text-[10px] text-gray-400 font-bold mb-1">ü•à SILVER</div>
                     <div class="w-full bg-slate-600/50 border-t-4 border-slate-400 h-16 rounded-t-lg flex items-center justify-center text-center px-1"><span id="podium-silver" class="text-xs font-bold text-white leading-tight">Team</span></div>
                </div>
                <div class="flex flex-col items-center justify-end w-1/3">
                     <div class="text-2xl mb-1">üëë</div>
                     <div class="text-[10px] text-yellow-400 font-bold mb-1">ü•á GOLD</div>
                     <div class="w-full bg-yellow-600/30 border-t-4 border-yellow-400 h-24 rounded-t-lg flex items-center justify-center text-center px-1 relative overflow-hidden"><div class="absolute inset-0 bg-yellow-400/10 animate-pulse"></div><span id="podium-gold" class="text-sm font-black text-white leading-tight relative z-10">Team</span></div>
                </div>
                <div class="flex flex-col items-center justify-end w-1/3 pt-8">
                     <div class="text-[10px] text-orange-400 font-bold mb-1">ü•â BRONZE</div>
                     <div class="w-full bg-orange-700/30 border-t-4 border-orange-500 h-12 rounded-t-lg flex items-center justify-center text-center px-1"><span id="podium-bronze" class="text-xs font-bold text-white leading-tight">Team</span></div>
                </div>
            </div>
            <div id="status-box" class="p-4 rounded-xl border text-sm font-bold text-center transition-all duration-500 glass-panel text-gray-500 border-white/5">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>
            <div class="glass-panel rounded-xl overflow-hidden">
              <div class="px-4 py-3 border-b border-white/5 bg-white/5 flex justify-between items-center"><h3 class="text-[10px] font-bold uppercase text-gray-400 tracking-widest">–ì—Ä—É–ø–ø–∞</h3><div class="h-1.5 w-1.5 rounded-full bg-green-500"></div></div>
              <table class="w-full text-xs sm:text-sm"><thead class="bg-white/5 text-gray-400 font-bold border-b border-white/5"><tr><th class="px-2 py-3 text-center w-6">#</th><th class="px-2 py-3 text-left">–ü–∞—Ä–∞</th><th class="px-1 py-3 text-center w-6 opacity-60">–ò</th><th class="px-1 py-3 text-center w-6 text-green-400">–í</th><th class="px-1 py-3 text-center w-8 opacity-60">–†–ì</th><th class="px-2 py-3 text-center font-black text-neon-blue w-8">–û</th></tr></thead><tbody id="standings-body" class="divide-y divide-white/5 text-gray-200"></tbody></table>
            </div>
            <div id="screenshot-footer" class="hidden text-center text-[9px] text-gray-600 mt-4 font-mono uppercase">Generated by Kondr Padel System</div>
        </div>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const STORAGE_KEY = "kondr_score_selects_v1";
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator(); const gainNode = audioCtx.createGain(); osc.connect(gainNode); gainNode.connect(audioCtx.destination);
        if (type === 'click') { osc.type = 'sine'; osc.frequency.setValueAtTime(800, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime+0.1); gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime+0.1); osc.start(); osc.stop(audioCtx.currentTime+0.1); } 
        else if (type === 'win') { osc.type = 'triangle'; osc.frequency.setValueAtTime(440, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(880, audioCtx.currentTime+0.1); gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+0.5); osc.start(); osc.stop(audioCtx.currentTime+0.5); }
      }
      function vibrate(pattern = 10) { if (navigator.vibrate) navigator.vibrate(pattern); }

      const teams = { A: { name: "–ê&–û", code: "A" }, B: { name: "–†&–ü", code: "B" }, C: { name: "–ù&–ú", code: "C" }, D: { name: "–°&–ö", code: "D" } };
      const groupSchedule = [ { id: 1, time: "17:10", t1: "A", t2: "B", court: 1 }, { id: 2, time: "17:10", t1: "C", t2: "D", court: 2 }, { id: 3, time: "17:35", t1: "A", t2: "C", court: 1 }, { id: 4, time: "17:35", t1: "B", t2: "D", court: 2 }, { id: 5, time: "18:00", t1: "A", t2: "D", court: 1 }, { id: 6, time: "18:00", t1: "B", t2: "C", court: 2 } ];

      let matchData = {}; let championConfetti = false;

      function init() { loadState(); renderGroupMatches(); recalc(); }
      function loadState() { try { const r = localStorage.getItem(STORAGE_KEY); const p = r ? JSON.parse(r) : {}; matchData = p.data || {}; championConfetti = p.confetti || false; } catch (e) { matchData = {}; } }
      function saveState() { localStorage.setItem(STORAGE_KEY, JSON.stringify({ data: matchData, confetti: championConfetti })); }

      // --- NEW: GENERATE SCORE OPTIONS 0-50 ---
      function getScoreOptions(selectedVal) {
          let opts = '<option value="">-</option>';
          for (let i = 0; i <= 50; i++) {
              opts += `<option value="${i}" ${String(selectedVal) === String(i) ? 'selected' : ''}>${i}</option>`;
          }
          return opts;
      }

      function renderGroupMatches() {
        const c = document.getElementById('matches-container'); c.innerHTML = '';
        groupSchedule.forEach(m => renderMatchItem(c, m, false));
      }

      function renderMatchItem(container, match, isFinal) {
          const data = matchData[match.id] || { score: '', winner: null };
          const scores = parseScoreObj(data.score); // {t1: val, t2: val}

          const t1 = isFinal ? match.t1Obj : teams[match.t1];
          const t2 = isFinal ? match.t2Obj : teams[match.t2];
          const t1Code = isFinal ? t1.code : match.t1;
          const t2Code = isFinal ? t2.code : match.t2;

          const getBtnClass = (code) => {
            const base = "flex-1 h-12 rounded-lg font-bold text-xs sm:text-sm tap-effect transition-all border flex items-center justify-center relative overflow-hidden ";
            if (data.winner === code) return base + "bg-neon-blue/20 text-white border-neon-blue shadow-[0_0_15px_rgba(59,130,246,0.5)] ring-1 ring-neon-blue"; 
            if (data.winner && data.winner !== code) return base + "bg-black/20 text-gray-600 border-transparent"; 
            return base + "bg-white/5 text-gray-400 border-white/5 hover:bg-white/10"; 
          };

          const el = document.createElement('div');
          el.className = isFinal ? (match.type === 'gold' ? "glass-gold p-4 rounded-xl flex flex-col gap-3" : "glass-bronze p-4 rounded-xl flex flex-col gap-3") : "glass-panel p-3 rounded-xl flex flex-col gap-3";
          let badge = isFinal ? (match.type === 'gold' ? 'üèÜ –§–ò–ù–ê–õ' : 'ü•â 3-–ï –ú–ï–°–¢–û') : `Match ${match.id}`;
          let badgeClass = isFinal ? (match.type === 'gold' ? 'bg-yellow-500 text-black' : 'bg-orange-500 text-black') : 'bg-white/5 text-gray-400 border border-white/5';

          el.innerHTML = `
            <div class="flex justify-between items-center px-1">
               <div class="flex items-center gap-2"><span class="px-2 py-0.5 rounded text-[10px] font-bold font-mono ${badgeClass}">${badge}</span><span class="text-[10px] font-bold text-gray-500">${match.time}</span></div>
               ${!isFinal ? `<span class="text-[10px] font-bold text-black bg-white/80 px-2 py-0.5 rounded shadow-lg">Court ${match.court}</span>` : ''}
            </div>
            <div class="flex items-center gap-2">
              <button class="${getBtnClass(t1Code)}" onclick="toggleWinner(${match.id}, '${t1Code}')">${t1.name}</button>
              
              <!-- NEW SELECT INPUTS -->
              <div class="flex items-center gap-1">
                  <select class="score-select w-12 h-10" onchange="updateScorePart(${match.id}, 't1', this.value)">
                     ${getScoreOptions(scores.t1)}
                  </select>
                  <span class="text-gray-500 font-bold text-lg">:</span>
                  <select class="score-select w-12 h-10" onchange="updateScorePart(${match.id}, 't2', this.value)">
                     ${getScoreOptions(scores.t2)}
                  </select>
              </div>

              <button class="${getBtnClass(t2Code)}" onclick="toggleWinner(${match.id}, '${t2Code}')">${t2.name}</button>
            </div>
          `;
          container.appendChild(el);
      }

      // --- NEW SCORE LOGIC ---
      function parseScoreObj(str) {
          if (!str) return { t1: '', t2: '' };
          const m = str.match(/^(\d+)[\-:](\d+)$/);
          return m ? { t1: m[1], t2: m[2] } : { t1: '', t2: '' };
      }

      window.updateScorePart = function(id, part, val) {
          if (!matchData[id]) matchData[id] = { winner: null };
          const current = parseScoreObj(matchData[id].score);
          if (part === 't1') current.t1 = val;
          if (part === 't2') current.t2 = val;
          
          // Save only if both or partial? Just save what we have.
          // Format: "X-Y" or just "" if incomplete? Let's save anyway.
          const s1 = current.t1 !== '' ? current.t1 : '0';
          const s2 = current.t2 !== '' ? current.t2 : '0';
          
          if (current.t1 === '' && current.t2 === '') matchData[id].score = '';
          else matchData[id].score = `${s1}-${s2}`;
          
          saveState();
          if (id <= 6) recalc(); 
      }

      window.toggleWinner = function(id, teamCode) {
        vibrate(15); playSound('click');
        if (!matchData[id]) matchData[id] = { score: '', winner: null };
        if (matchData[id].winner === teamCode) matchData[id].winner = null; else matchData[id].winner = teamCode;
        if (id === 7) championConfetti = false;
        saveState();
        if (id <= 6) recalc(); else { renderFinals(window.lastRankedList); checkChampion(); }
      }

      function getParsedScore(str) {
        if (!str) return null;
        const m = str.match(/^(\d+)[\-:](\d+)$/);
        return m ? { a: +m[1], b: +m[2] } : null;
      }

      function recalc() {
        const stats = {}; Object.keys(teams).forEach(k => stats[k] = { code: k, name: teams[k].name, p: 0, w: 0, l: 0, gf: 0, ga: 0, pts: 0 });
        let playedCount = 0;
        groupSchedule.forEach(m => {
          const d = matchData[m.id];
          if (!d || !d.winner) return;
          playedCount++;
          const w = d.winner; const l = m.t1 === w ? m.t2 : m.t1;
          stats[w].p++; stats[w].w++; stats[w].pts += 2; stats[l].p++; stats[l].l++;
          const s = getParsedScore(d.score);
          if (s) { stats[m.t1].gf += s.a; stats[m.t1].ga += s.b; stats[m.t2].gf += s.b; stats[m.t2].ga += s.a; }
        });

        const list = Object.values(stats).map(t => ({...t, diff: t.gf - t.ga}));
        list.sort((a,b) => (b.pts - a.pts) || (b.diff - a.diff) || (b.gf - a.gf));
        window.lastRankedList = list;

        const tbody = document.getElementById('standings-body'); tbody.innerHTML = '';
        list.forEach((t, i) => {
          const diff = t.p > 0 ? (t.diff > 0 ? `+${t.diff}` : t.diff) : '-';
          const isLeader = (i === 0 && t.p > 0);
          const tr = document.createElement('tr');
          tr.className = isLeader ? "bg-gradient-to-r from-neon-blue/20 to-transparent font-bold" : "hover:bg-white/5 transition-colors";
          tr.innerHTML = `<td class="px-2 py-3 text-center text-gray-500 text-[10px] font-mono">${i+1}</td><td class="px-2 py-3 font-medium text-xs sm:text-sm ${isLeader ? 'text-white' : 'text-gray-400'}">${t.name}</td><td class="px-1 py-3 text-center text-xs text-gray-600 font-mono">${t.p||'0'}</td><td class="px-1 py-3 text-center text-xs text-green-400 font-mono">${t.w||'0'}</td><td class="px-1 py-3 text-center text-xs text-gray-500 font-mono">${diff}</td><td class="px-3 py-3 text-center font-black text-sm ${isLeader ? 'text-neon-blue' : 'text-gray-300'}">${t.pts}</td>`;
          tbody.appendChild(tr);
        });
        
        renderGroupMatches();
        const playoffsSection = document.getElementById('playoffs-section');
        const statusBox = document.getElementById('status-box');
        if (playedCount === 6) {
            playoffsSection.classList.remove('hidden'); playoffsSection.classList.add('flex');
            renderFinals(list); checkChampion();
        } else {
            playoffsSection.classList.add('hidden'); playoffsSection.classList.remove('flex');
            if (playedCount > 0) { statusBox.className = "p-4 rounded-xl border border-neon-blue/30 bg-neon-blue/5 text-neon-blue shadow-soft"; statusBox.innerHTML = `<div class="text-[10px] text-neon-blue/70 font-bold uppercase tracking-widest mb-1">–õ–∏–¥–µ—Ä –≥—Ä—É–ø–ø—ã</div><div class="text-xl font-black text-white">${list[0].name}</div>`; }
            else { statusBox.className = "p-4 rounded-xl border border-white/5 bg-white/5 text-gray-500 shadow-soft"; statusBox.innerHTML = "–°—ã–≥—Ä–∞–π—Ç–µ –≥—Ä—É–ø–ø—É (6 –º–∞—Ç—á–µ–π)"; }
        }
      }

      function renderFinals(rankedList) {
          const c = document.getElementById('finals-container'); c.innerHTML = '';
          renderMatchItem(c, { id: 7, time: "18:30", type: 'gold', t1Obj: rankedList[0], t2Obj: rankedList[1] }, true);
          renderMatchItem(c, { id: 8, time: "18:30", type: 'bronze', t1Obj: rankedList[2], t2Obj: rankedList[3] }, true);
      }

      function checkChampion() {
          const f = matchData[7]; const b = matchData[8];
          const sb = document.getElementById('status-box');
          let h = ''; let c = "p-4 rounded-xl border border-white/5 bg-white/5 text-gray-500 shadow-soft";
          
          if (b && b.winner && (!f || !f.winner)) {
              const w = teams[b.winner].name;
              c = "p-4 rounded-xl border border-orange-500/30 bg-orange-500/10 text-orange-200 shadow-soft";
              h = `<div class="text-[10px] font-bold uppercase tracking-widest mb-1 text-orange-400">–ë—Ä–æ–Ω–∑–æ–≤—ã–π –ø—Ä–∏–∑–µ—Ä</div><div class="text-xl font-bold text-white">ü•â ${w}</div>`;
          }
          if (f && f.winner) {
             // FIX: LOOKUP NAME FROM RENDERED LIST, NOT STATIC TEAMS DIRECTLY BY ID, OR USE CODE
             // Actually winner is stored as CODE 'A', 'B', etc.
             const wCode = f.winner;
             const wName = teams[wCode].name;
             c = "p-5 rounded-xl border border-yellow-500/50 bg-gradient-to-br from-yellow-900/40 to-black text-yellow-100 shadow-[0_0_30px_rgba(234,179,8,0.2)] relative overflow-hidden";
             h = `<div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-yellow-500 rounded-full opacity-20 blur-2xl animate-pulse-slow"></div><div class="text-[10px] uppercase font-black text-yellow-500 mb-2 tracking-[0.2em]">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å —Ç—É—Ä–Ω–∏—Ä–∞</div><div class="text-2xl font-black text-white drop-shadow-lg animate-bounce-slow">üëë ${wName}</div>`;
             if (!championConfetti) { playSound('win'); vibrate([100, 50, 100, 50, 500]); launchConfetti(); championConfetti = true; saveState(); }
          }
          if (!h) { h = `<div class="text-[10px] font-bold uppercase tracking-widest mb-1">–ì—Ä—É–ø–ø–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</div><div class="font-bold">–ò–≥—Ä–∞–µ–º —Ñ–∏–Ω–∞–ª—ã!</div>`; c = "p-4 rounded-xl border border-yellow-500/30 bg-yellow-500/10 text-yellow-200 shadow-soft"; }
          sb.className = c; sb.innerHTML = h;
      }
      function getSilverName() {
          const m7 = matchData[7]; if (!m7 || !m7.winner) return "TBD";
          const w = m7.winner; const p1 = window.lastRankedList[0].code; const p2 = window.lastRankedList[1].code;
          return w === p1 ? teams[p2].name : teams[p1].name;
      }
      function launchConfetti() {
        var d = 4000; var e = Date.now() + d; var def = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
        function r(min, max) { return Math.random() * (max - min) + min; }
        var i = setInterval(function() {
          var t = e - Date.now(); if (t <= 0) return clearInterval(i);
          var p = 50 * (t / d); confetti(Object.assign({}, def, { particleCount: p, origin: { x: r(0.1, 0.3), y: Math.random() - 0.2 } }));
          confetti(Object.assign({}, def, { particleCount: p, origin: { x: r(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
      }

      // MODAL & SHARE
      document.getElementById('rules-btn').addEventListener('click', () => document.getElementById('rules-modal').classList.remove('hidden'));
      document.getElementById('close-rules').addEventListener('click', () => document.getElementById('rules-modal').classList.add('hidden'));
      document.getElementById('rules-ok').addEventListener('click', () => document.getElementById('rules-modal').classList.add('hidden'));
      document.getElementById('reset-btn-trigger').addEventListener('click', () => document.getElementById('reset-modal').classList.remove('hidden'));
      document.getElementById('modal-cancel').addEventListener('click', () => document.getElementById('reset-modal').classList.add('hidden'));
      document.getElementById('modal-confirm').addEventListener('click', () => { localStorage.removeItem(STORAGE_KEY); matchData = {}; championConfetti = false; init(); document.getElementById('reset-modal').classList.add('hidden'); });
      document.getElementById('close-photo-modal').addEventListener('click', () => { document.getElementById('photo-modal').classList.add('hidden'); document.getElementById('photo-container').innerHTML = ''; });
      function showToast(msg) { const t = document.getElementById('toast'); document.getElementById('toast-msg').textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); }

      document.getElementById('share-btn').addEventListener('click', async () => {
        const l = document.getElementById('screenshot-loader'); const t = document.getElementById('capture-target'); const h = document.getElementById('screenshot-header'); const f = document.getElementById('screenshot-footer'); const p = document.getElementById('screenshot-podium');
        l.classList.remove('hidden'); h.classList.remove('hidden'); f.classList.remove('hidden');
        if (matchData[7] && matchData[7].winner && matchData[8] && matchData[8].winner) {
            p.classList.remove('hidden'); p.classList.add('flex');
            document.getElementById('podium-gold').textContent = teams[matchData[7].winner].name;
            document.getElementById('podium-silver').textContent = getSilverName();
            document.getElementById('podium-bronze').textContent = teams[matchData[8].winner].name;
        }
        try {
            await new Promise(resolve => setTimeout(resolve, 200));
            const c = await html2canvas(t, { scale: 3, backgroundColor: '#0f172a', useCORS: true, logging: false });
            c.toBlob(async (blob) => {
                if (!blob) { showImageInModal(c); return; }
                const file = new File([blob], 'kondr-results.png', { type: 'image/png' });
                if (navigator.canShare && navigator.canShare({ files: [file] })) { try { await navigator.share({ files: [file], title: 'Kondr Padel' }); showToast("–ú–µ–Ω—é Share –æ—Ç–∫—Ä—ã—Ç–æ"); } catch (e) { if (e.name !== 'AbortError') showImageInModal(c); } } else { showImageInModal(c); }
                cleanup();
            }, 'image/png');
        } catch (err) { showToast("–û—à–∏–±–∫–∞ —Ñ–æ—Ç–æ"); cleanup(); }
        function showImageInModal(cvs) { const img = new Image(); img.src = cvs.toDataURL(); img.className = "w-full h-auto block"; document.getElementById('photo-container').innerHTML = ''; document.getElementById('photo-container').appendChild(img); document.getElementById('photo-modal').classList.remove('hidden'); cleanup(); }
        function cleanup() { l.classList.add('hidden'); h.classList.add('hidden'); f.classList.add('hidden'); p.classList.add('hidden'); p.classList.remove('flex'); }
      });

      init();
    });
  </script>
</body>
</html>

